@attribute [Authorize]
@page "/"
@using Blazored.Modal
@using Blazored.Modal.Services
@using Microsoft.AspNetCore.Authorization;
@using Ticketing_UI.Pages.Programs
@using Ticketing.Contract
<PageTitle>Index</PageTitle>
 <AuthorizeView>
    <Authorized>


        <h1>برنامه ثبت تیک های پشتیبانی</h1>

        @*<SurveyPrompt Title="How is Blazor working for you?" />*@
        @*<LoginPage />*@
        <NavLink class="nav-link" href="CentersList">
            <button class="alert-primary"> نمایش لیست مراکز</button>
        </NavLink>

        <NavLink class="nav-link" href="PersonsList">
            <button class="alert-primary"> نمایش لیست پرسنل</button>

        </NavLink>

        <NavLink class="nav-link" href="ProgramsList">
            <button class="alert-primary"> نمایش لیست برنامه ها</button>

        </NavLink>

        <NavLink class="nav-link" href="TicketsList">
            <button class="btn btn-info" style="animation"> نمایش لیست تیکت ها</button>

        </NavLink>
    </Authorized>
</AuthorizeView>




@code {
    private FetchDataStatus fetchDataStatus = FetchDataStatus.fetching;


    protected override Task OnAfterRenderAsync(bool firstRender)
    {
        if(firstRender)
        {
            FetchRequestsFromServer();
        }
        return base.OnAfterRenderAsync(firstRender);
    }

    private async Task FetchRequestsFromServer()
    {
        fetchDataStatus = FetchDataStatus.fetching;
        StateHasChanged();
        try
        {
            fetchDataStatus = FetchDataStatus.succeed;
        }
        catch(Exception ex)
        {
            fetchDataStatus = FetchDataStatus.failed;
        }
        StateHasChanged();
    }

    public void ReRenderPendingRequests()
    {
        FetchRequestsFromServer();
    }

}